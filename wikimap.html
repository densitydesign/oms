<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>WHO - Wikipedia page spoils</title>

<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
<script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.1/mapbox.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.1/mapbox.css' rel='stylesheet' />

<script src='//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js'></script>
<script src="js/d3.v3.min.js"></script>
<link href='//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet' />
<link href='//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css' rel='stylesheet' />


<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
  .marker-cluster-small, .marker-cluster-medium, .marker-cluster-large   {
  	background-color:rgba(52, 205, 135, 0.79);
  	border-radius:100%;
 }
 
   .marker-cluster-small-2, .marker-cluster-medium-2, .marker-cluster-large-2   {
  	background-color:rgba(212, 81, 88, 0.79);
  	border-radius:100%;
 }

.marker-cluster-small div, .marker-cluster-medium div, .marker-cluster-large div, .marker-cluster-small-2 div, .marker-cluster-medium-2 div, .marker-cluster-large-2 div {
	background-color:transparent;
	color:white;
	width:100%;
	height:100%;
	margin:0;
	
	
}

.marker-cluster-small span, .marker-cluster-medium span, .marker-cluster-large span, .marker-cluster-small-2 span, .marker-cluster-medium-2 span, .marker-cluster-large-2 span {
	
text-align: center;

}

.leaflet-marker-icon {
	opacity:0.79 !important;
	-webkit-transition: -webkit-transform 0.5s ease-in; /* Changed here */ 
	-moz-transition: -moz-transform 0.5s ease-in, width 0.5s;
	-o-transition: -o-transform 0.5s ease-in, width 0.5s;
	transition: transform 0.5s ease-in, width 0.5s;
}
  
</style>
</head>
<body>




<div id='map'></div>

<script>
var mapdata;
var s = d3.scale.linear().range([20,80]).domain([2,100]).clamp(true)
var map,markers, markers2;

d3.tsv("data/wiki_map.tsv",function(error, data) {
		
			mapdata=data;
			drawMap();			
		});

function drawMap() {
    map = L.mapbox.map('map', 'fenicento.ha4jo7ff')
        .setView([18.95, 18.08333], 3);
	
    markers = new L.MarkerClusterGroup({showCoverageOnHover:false,iconCreateFunction: spoilCluster, animateAddingMarkers:true,spiderfyOnMaxZoom:true});
    markers2 = new L.MarkerClusterGroup({showCoverageOnHover:false, iconCreateFunction: notSpoilCluster,animateAddingMarkers:true,spiderfyOnMaxZoom:true});

    for (var i = 0; i < mapdata.length; i++) {
        var a = mapdata[i];
       
        if(a.lat!="" && a.lon!="" && a.page=="Birth Control") {
        var title = a['revid'];
        var type = a['type'];
        var date = a['date'];
        var comment = a['comment'];
        var user = a['user'];
        
        var marker = L.circleMarker(new L.LatLng(a['lat'].replace(",","."), a['lon'].replace(",",".")), {
            //icon: L.mapbox.marker.icon({ 'marker-color': 'd45158'}),
            radius: 5,
        	fillColor: "#d45158",
        	stroke: false,
        	fillOpacity: 0.69,
            title: title,
            date: date,
            user: user,
            comment: comment,
            type: type
        });
        marker.bindPopup("<br/><div><b>Date:</b> "+date+"</div><div><b>User:</b> "+user+"</div><div><b>Revision id:</b> "+title+"</div><div><b>type:</b> "+type+"</div><div><b>Comment:</b> "+comment+"</div>");
        markers.addLayer(marker);
       }
       
       else if(a.lat!="" && a.lon!="" && a.page=="Family Planning") {
       	
        var title = a['revid'];
        var type = a['type'];
        var date = a['date'];
        var comment = a['comment'];
        var user = a['user'];
        
        var marker = L.circleMarker(new L.LatLng(a['lat'].replace(",","."), a['lon'].replace(",",".")), {
            //icon: L.mapbox.marker.icon({ 'marker-color': '34CD87'}),
            radius: 5,
        	fillColor: "#34CD87",
        	stroke: false,
        	fillOpacity: 0.69,
            title: title,
            date: date,
            user: user,
            comment: comment,
            type: type
        });
        marker.bindPopup("<br/><div><b>Date:</b> "+date+"</div><div><b>User:</b> "+user+"</div><div><b>Revision id:</b> "+title+"</div><div><b>type:</b> "+type+"</div><div><b>Comment:</b> "+comment+"</div>");
        markers2.addLayer(marker);
       	
       }
    }

    map.addLayer(markers);
    map.addLayer(markers2);
   }
   
   
   function spoilCluster(cluster) {
		var childCount = cluster.getChildCount();

		var c = ' marker-cluster-';
		if (childCount < 10) {
			c += 'small';
		} else if (childCount < 100) {
			c += 'medium';
		} else {
			c += 'large';
		}
		c+="-2"
		return new L.DivIcon({ html: '<div><span style="line-height:'+s(childCount)+'px;">' + childCount + '</span></div>', className: 'marker-cluster' + c, iconSize: new L.Point(s(childCount), s(childCount)) });
	}
	
	
	 function notSpoilCluster(cluster) {
		var childCount = cluster.getChildCount();

		var c = ' marker-cluster-';
		if (childCount < 10) {
			c += 'small';
		} else if (childCount < 100) {
			c += 'medium';
		} else {
			c += 'large';
		}
		
		return new L.DivIcon({ html: '<div><span style="line-height:'+s(childCount)+'px;">' + childCount + '</span></div>', className: 'marker-cluster' + c, iconSize: new L.Point(s(childCount), s(childCount)) });
	}
   
   function removeSpoil() {
   	
   	//birth control
   	markers.eachLayer(function (layer) {
   		if(layer.options.type!="spoil") markers.removeLayer(layer)
   	})
   	
   	//family planning
   	markers2.eachLayer(function (layer) {
   		if(layer.options.type!="spoil") markers2.removeLayer(layer)
   	})
   }
   
   
   function pilipinos() {
   	
   	map.setView([11.583333, 122.75],6,{animate:true});
   	
   }
</script>


</body>
</html>