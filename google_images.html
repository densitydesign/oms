<!DOCTYPE html>
<html>
  <head>
    <title>Bootstrap 101 Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/app.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <script src="js/bootstrap.min.js"></script>		
    <script src="js/bootstrap-slider.js"></script>		
	 <link href="css/slider.css" rel="stylesheet">
	  <script src="js/jquery.mousewheel.js"></script>
    <script src="js/d3.v3.min.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    
    
  </head>
  <body>
  	<style>


text {
  font: 10px sans-serif;
}

.sel {
	fill:#83A493 !important;
	-webkit-transition: fill .3s ease;
        -moz-transition: fill .3s ease;
        -o-transition: fill .3s ease;
        transition: fill .3s ease;
}

svg {
	margin-top:40px;
}

#viz{
	margin-top:4%;
	width:100%;
}
.container{
	height:90%;
}
.imgs{
	float:left;
	width:45%;
	overflow:auto;
}
svg{
	margin-right: 2%;
}
.slider{
	width:45% !important;
	float:left;
	clear:right;
	margin-top:40px;
	margin-bottom:10px;
}
.btn, .btn:hover,.btn:focus {
	background:#83A493;
	border:1px solid white;
	color:#fff;
}
.rad{
	margin:0px 0px 10px 0px;
	
}
.img-cont{
	 
	float:left;
	transition: width 2s;
-webkit-transition: width 0.2s; /* Safari */
transition: height 2s;
-webkit-transition: height 0.2s; /* Safari */
}
.smallImg{
	width:100%;
	height:auto;
}

</style>
  	
  	
  	
     <!-- Fixed navbar -->
    
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
       
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="./intro.html">intro</a></li>
            <li class="active"><a href="./network1.html">corpus</a></li>
            <li><a href="./network2.html">network</a></li>
            <li><a href="./network3.html">text</a></li>
            <li><a href="./network4.html">images</a></li>
            <li><a href="./intro1.html">aufeminin</a></li>
            <li><a href="./network5.html">forums</a></li>
            <li><a href="./network6.html">users</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
  
  	<div class="container">
  	<section id="viz" class="row section-row">
  		
  	</section>
  	</div>
	
	<div id="protocol">
			
		<div class="proto-title closing">PROTOCOL   <img class="close-btn" src="img/cross.png"/></div>
		
		
		<div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
				  <!-- Indicators -->
		  <ol class="carousel-indicators">
		    <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
		    <li data-target="#carousel-example-generic" data-slide-to="1"></li>
		  </ol>

		  <!-- Wrapper for slides -->
		  <div class="carousel-inner">
		    <div class="item active">
		    	
		    	<div class="step">
		    		<img src="img/pro_query-net.png"/>
				    	<h3>1.Querying<br>(corpus building)</h3>
				    	<p>I will give you a complete account of the
						system, and expound the actual teachings
						of the great explorer of the truth.</p>
						<div class="details">
							<h5>Corpus: 336 webpages</h5>
						</div>
				    </div>
				    
				    <div class="step">

		    		<img src="img/pro_clean.png"/>
				    	<h3>2.Cleaning</h3>
				    	<p>I will give you a complete account of the
						system, and expound the actual teachings
						of the great explorer of the truth.</p>
						<div class="details">
						<h5>Corpus: ? webpages </h5>
				    		<a href="#"><div class="link-download">Download Data</div></a>
							<a href="#"><div class="link-visualization">Go to the Visualization</div></a>
						</div>
				    </div>
				    
				    <div class="step">
		    		<img src="img/pro_tag-cs"/>
				    	<h3>3.Tagging</h3>
				    	<p>I will give you a complete account of the
						system, and expound the actual teachings
						of the great explorer of the truth.</p>
				    	<div class="details">
				    	<h5>Corpus: 336 webpages </h5>
				    		<a href="#"><div class="link-download">Download Data</div></a>
							<a href="#"><div class="link-visualization">Go to the Visualization</div></a>
						</div>

				    </div>

		    	</div>
		    	
		    	<div class="item">
		  
				    <div class="step">
		    		<img src="img/pro_crawl.png"/>
				    	<h3>Crawling</h3>
				    	<p>I will give you a complete account of the
						system, and expound the actual teachings
						of the great explorer of the truth.</p>
						<div class="details">
							<h5>Corpus: 677 websites </h5>
				    		<a href="#"><div class="link-download">Download Data</div></a>
							<a href="#"><div class="link-visualization">Go to the Visualization</div></a>
						</div>
				    </div>
		    	</div>
		    	
		  </div>
		  </div>
		
		  <!-- Controls -->
		  
		</div>
			
	</div>
	
	<script>
var col=true;
var siz=50;
var data;
var langLvl=0;
var langScale,tagScale;
var dsv_egg = d3.dsv(";", "text/plain");

dsv_egg("data/CS_img.csv",function(d) {
  return {
  	keyword: d.keyword,
    image: d.image,
    lang: d.lang,
    rank: +d.rank,
    color: d.color
  };
}, 
	function(error, rows) {
	  
   		data = d3.nest()
   		.key(function(d) {return d.lang; })
        .key(function(d) {return d.keyword; })
        .entries(rows);
        
        maxH=0
        
	    data.forEach(function (d,i) {
	    	d.count=0;
			d.y=maxH
	    	d['values'].forEach(function(e,j) {
	    		maxH+=e['values'].length
	    		d.count+=e['values'].length
	    		
	    	});
	    });
	    
		viz();
	});
     
     var margin = {top: 40, right: 10, bottom: 10, left: 10},
    width = $("#viz").width()*.45 - margin.left - margin.right,
    height =  $("#viz").height() - margin.top - margin.bottom;
     
     
     var listW = width*0.45;
     
     var svg, langs, tags;
     svg = d3.select("#viz").append("svg")
    .attr("width", (width + margin.left + margin.right))
    .attr("height", (height + margin.top + margin.bottom))
    .attr("style", "float:left")
    
    d3.select("#viz").append("div")
    .attr("class","slider")
    
    $(".slider").slider({'min':10,'max':100, 'value':50})
    .on('slide', function(ev){
    	changeSize(ev.value)
    });
    
    d3.select("#viz").append("div")
    .attr("class","rad")
    .attr("style","float:left; clear:right")
    
    $(".rad").append('<button class="btn">Toggle pictures / colors</button>')
    
    
    d3.select("#viz").append("div")
    .attr("class","imgs")
 
    offset=$(".imgs").position().top
    $(".imgs").height(height-offset);
    
    var t=d3.select("svg").append("g").attr("class","tag-group")
    
     function viz() {
    
    //scale function 	
	langScale = d3.scale.linear().domain([0, maxH]);
	langScale.range([0, height]) 

	//draw lang rects
    langs = svg.selectAll(".lang").data(data)
    .enter()
    .append("rect")
    .attr("class", "lang")
	.attr("x",  20)
	.attr("y", function(d){return langScale(d.y)+2})
    .attr("width", listW)
	.attr("height", function(d) {return langScale(d.count) })
    .style("fill", function(d) {return "#dddddd";})
    .style("stroke","#999999")
    .on("click", function(d){
    	
    	//color current selection
    	d3.select(".lang.sel").classed("sel",false)
    	d3.select(this).classed("sel",true)
    	
    	//ealstify list
    	elastify(d)
    	if($(".tag.sel").length) {
    		console.log(d)
    		k=d3.select(".tag.sel")[0][0].__data__.key
    		el=d.values.filter(function(e){return e.key==k})
    		loadImages(el[0])
    	}
    	});
    
    //labels for languages 
    svg.selectAll(".lang-txt")
    .data(data)
    .enter()
    .append("text")
    .attr("class", "lang-txt")
    .attr("font-family", "serif")
	.attr("font-size", "1em")
	.attr("x",  20)
	.attr("y", function(d){return langScale(d.y)+2})
	.attr("dx", "0.4em")
	.attr("dy", "1.3em")
	.style("fill","#222222")
	.text(function(d){console.log(d);return d.key})
      
    }


     function elastify(d) {
     	
     	//compute height
     	tagH=0
		
		//t.attr("transform","rotate(30)")
		
     	d['values'].sort(function(a,b) {
     		return b['values'].length-a['values'].length
     		})
     	
     	d['values'].forEach(function(e,i){
     		
     		//e.y=tagH;
     		tagH+=e['values'].length	
     	})
     	
     	//rescale the scale 
     	
     	tagScale = d3.scale.linear().range([height/37, height/1.75]); 
     	tagScale.domain([0, tagH]).clamp(true)
     	vals=0
     	d['values'].forEach(function(e,i){
     		
     		e.y=vals;
     		e.h=tagScale(e['values'].length)
     		vals+=e.h	
     	})

     	//draw section
     	
     	tags= t.selectAll(".tag").data(d.values,function(e){return e.key})
     	
	    var enter = tags.enter()
	    .append("rect")
	    
	    //enter new elements
	    enter.attr("class","tag")
	    .attr("x",  40+listW)
		.attr("y", function(e){return e.y})
	    .attr("width", listW)
		.attr("height", function(e) {return e.h })
	    .style("fill", function(e) {return "#dddddd";})
	    .style("stroke","#999999")
	    .on("click", function(d){
    	
	    	//color current selection
	    	d3.select(".tag.sel").classed("sel",false)
	    	d3.select(this).classed("sel",true)
	    	loadImages(d);
    	});
	    
	    //transition on existing
	    tags.transition().duration(500)
	    .attr("y", function(e){return e.y})
		.attr("height", function(e) {return e.h })
		.each("end",function() {
			
			rawH=t[0][0].getBBox().height;
			
			t.transition().duration(100).attr("transform","scale(1,"+height/rawH+")")
		})
	    
	    //remove old elements
	    tags.exit().remove();
	    
	    //Text
	    txt = t.selectAll(".tag-txt")
	    .data(d.values,function(e){return e.key})
	    
	    txtEnt=txt.enter()
	    .append("text")
	    
	    txtEnt
	    .attr("class", "tag-txt")
	    .attr("font-family", "serif")
		.attr("font-size", "1em")
		.attr("x",  40+listW)
		.attr("y", function(e){return e.y})
		.attr("dx", "0.4em")
		.attr("dy", "1.3em")
		.style("fill","#222222")
		.text(function(d){return d.key})
		
		txt.transition().duration(500)
		.attr("y", function(e){return e.y})

		txt.exit().remove()
     }
     
     function loadImages(d) {
     	$(".imgs").empty();
     	d.values.forEach(function(e,i) {
     		$(".imgs").append("<div class='img-cont' style='width:"+siz+"px;height:"+siz+"px;background:"+e.color+"'><img class='smallImg' src='img/cs_thumb/"+e.lang+"/t_"+e.image+"'/></div>")
     		if (!col) {
     			$(".imgs img").hide();
     		} 		
     	})
     }
     
     function changeSize(n) {
	     siz=n;
	     $(".img-cont").css("width",n+"px")
	     $(".img-cont").css("height",n+"px")
     }

     $(".btn").on("click",function(e){
     	col=!col;
     	if(col) $(".imgs img").fadeIn(300)
     	else $(".imgs img").fadeOut(300)
     })
     
     d3.select(window).on("resize", function() {
		d3.select("svg").attr("width", $("#viz").width()*0.45);
		d3.select("svg").attr("height", $("#viz").height());
	});
     
</script>
	
	
    
  </body>
</html>