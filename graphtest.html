<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script type="text/javascript" src="js/d3.v3.min.js"></script>
<script>

var width = 900,
    height = 900;

var canvas = d3.select("body").append("canvas")
    .attr("width", width)
    .attr("height", height);

var force = d3.layout.force()
    .charge(-50)
    .linkDistance(10)
    .size([width, height]);

var xScale = d3.scale.linear().range([20, height-20])
var yScale = d3.scale.linear().range([20, width-20])

var rScale = d3.scale.linear().range([1, 10])

d3.json("data/cs_crawl.json", function(graph) {
  var context = canvas.node().getContext("2d");

  var xDomain = d3.extent(graph.nodes.map(function(d){return d.x}))
  var yDomain = d3.extent(graph.nodes.map(function(d){return d.y}))
  var rDomain = d3.extent(graph.nodes.map(function(d){return d.size}))

  xScale.domain(xDomain)
  yScale.domain(yDomain)
  rScale.domain(rDomain)


  var nodesID = {};
  graph.nodes.forEach(function(d, i){
      nodesID[d.id] = i
  })

  graph.edges.forEach(function(d){
      d.source = nodesID[d.source]
      d.target = nodesID[d.target]
  })

console.log(graph)
    context.clearRect(0, 0, width, height);
    context.globalCompositeOperation = 'multiply';

    // draw links
    context.strokeStyle = "#ccc";
    context.lineWidth = 0.5;
    context.beginPath();
    graph.edges.forEach(function(d) {
      context.moveTo(xScale(graph.nodes[d.source].x), yScale(graph.nodes[d.source].y));
      context.lineTo(xScale(graph.nodes[d.target].x), yScale(graph.nodes[d.target].y));
    });
    context.stroke();

    context.globalCompositeOperation = 'source-over';
    // draw nodes
    context.fillStyle = "steelblue";
    context.beginPath();
    graph.nodes.forEach(function(d) {
      context.moveTo(xScale(d.x), yScale(d.y));
      context.arc(xScale(d.x), yScale(d.y), rScale(d.size), 0, 2 * Math.PI);
    });
    context.fill();



  function animate() {
      var  start = (new Date()).getTime();

    function step() {
      var t = ((new Date()).getTime() - start) / 200;

      console.log(t)
          //p = d3.ease(t);

      if (t < 1) {
        window.requestAnimationFrame(step);
        console.log("ciao")
      }
    }

    step();
  }

animate()
  // force
  //     .nodes(graph.nodes)
  //     .links(graph.edges)
      //.on("tick", tick)
      //.start();

  function tick() {
    context.clearRect(0, 0, width, height);

    // draw links
    context.strokeStyle = "#ccc";
    context.beginPath();
    graph.edges.forEach(function(d) {
      context.moveTo(d.source.x, d.source.y);
      context.lineTo(d.target.x, d.target.y);
    });
    context.stroke();

    // draw nodes
    context.fillStyle = "steelblue";
    context.beginPath();
    graph.nodes.forEach(function(d) {
      context.moveTo(d.x, d.y);
      context.arc(d.x, d.y, 4.5, 0, 2 * Math.PI);
    });
    context.fill();
  }
});

</script>
