

<div class="side-panel">
			
			<div class="adva-cont">
			
				<div class="adv-step step1" style="display:block;">
					
					<h4>A short first title</h4>
					<p>
						Nevertheless, upon Stubb setting the anchor-watch after his supper was concluded; and when, accordingly, Queequeg and a forecastle seaman came on deck, no small excitement was created among the sharks; for immediately suspending the cutting stages over the side, and lowering three lanterns, so that they cast long gleams of light over the turbid sea, these two mariners, darting their long whaling-spades, kept up an incessant murdering of the sharks,* by striking the keen steel deep into their skulls, seemingly their only vital part. But in the foamy confusion of their mixed and struggling hosts, the marksmen could not always hit their mark; and this brought about new revelations of the incredible ferocity of the foe. 
					</p>
					
				</div>
			
				<div class="adv-step step2">
					
					<h4>A short second title</h4>
					<p>
						Nevertheless, upon Stubb setting the anchor-watch after his supper was concluded; and when, accordingly, Queequeg and a forecastle seaman came on deck, no small excitement was created among the sharks; for immediately suspending the cutting stages over the side, and lowering three lanterns, so that they cast long gleams of light over the turbid sea, these two mariners, darting their long whaling-spades, kept up an incessant murdering of the sharks,* by striking the keen steel deep into their skulls, seemingly their only vital part. But in the foamy confusion of their mixed and struggling hosts, the marksmen could not always hit their mark; and this brought about new revelations of the incredible ferocity of the foe. 
					</p>
					
				</div>
				
				<div class="adv-step step3">
					
					<h4>A short third title</h4>
					<p>
						Nevertheless, upon Stubb setting the anchor-watch after his supper was concluded; and when, accordingly, Queequeg and a forecastle seaman came on deck, no small excitement was created among the sharks; for immediately suspending the cutting stages over the side, and lowering three lanterns, so that they cast long gleams of light over the turbid sea, these two mariners, darting their long whaling-spades, kept up an incessant murdering of the sharks,* by striking the keen steel deep into their skulls, seemingly their only vital part. But in the foamy confusion of their mixed and struggling hosts, the marksmen could not always hit their mark; and this brought about new revelations of the incredible ferocity of the foe. 
					</p>
					
				</div>
				
				
	
			</div>
		<div class="legend">
			
			<h5>Legend</h5>
			<div><div class="legend-dot" style="background:#d45158"></div><p>Birth Control</p></div>
			<div><div class="legend-dot" style="background:#34CD87"></div><p>Family Planning</p></div>
			
		</div>
</div>

<div id="map-container"></div>

<style>
  #map { position:absolute; top:0; bottom:0; width:100%; }
  .marker-cluster-small, .marker-cluster-medium, .marker-cluster-large   {
  	background-color:rgba(52, 205, 135, 0.79);
  	border-radius:100%;
 }
 
   .marker-cluster-small-2, .marker-cluster-medium-2, .marker-cluster-large-2   {
  	background-color:rgba(212, 81, 88, 0.79);
  	border-radius:100%;
 }

.marker-cluster-small div, .marker-cluster-medium div, .marker-cluster-large div, .marker-cluster-small-2 div, .marker-cluster-medium-2 div, .marker-cluster-large-2 div {
	background-color:transparent;
	color:white;
	width:100%;
	height:100%;
	margin:0;
	
	
}

.marker-cluster-small span, .marker-cluster-medium span, .marker-cluster-large span, .marker-cluster-small-2 span, .marker-cluster-medium-2 span, .marker-cluster-large-2 span {
	
text-align: center;

}

.leaflet-marker-icon {
	opacity:0.79 !important;
	-webkit-transition: -webkit-transform 0.5s ease-in; /* Changed here */ 
	-moz-transition: -moz-transform 0.5s ease-in, width 0.5s;
	-o-transition: -o-transform 0.5s ease-in, width 0.5s;
	transition: transform 0.5s ease-in, width 0.5s;
}

#map-container {
	float:left;
	margin-top:56px;
	height:94%;
	width:80%;
}

.legend-dot{
	width:20px;
	height:20px;
	border-radius:100%;
	float:left;
	opacity:0.69;
	margin-right:5px;
}

.legend-dot p{
	display:block;
	float:left;
}



  
</style>

<script>
var mapdata;
var s = d3.scale.linear().range([20,80]).domain([2,100]).clamp(true)
var map, markers_cs, markers_fp, markers_sp_cs, markers_sp_fp;

d3.tsv("data/wiki_map.tsv",function(error, data) {
		
			mapdata=data;
			drawMap();
		});

function drawMap() {
    map = L.mapbox.map('map-container', 'fenicento.ha4jo7ff',{scrollWheelZoom:false})
        .setView([18.95, 18.08333], 3);
	
    markers_cs = new L.MarkerClusterGroup({showCoverageOnHover:false,iconCreateFunction: bcCluster,spiderfyOnMaxZoom:true});
    markers_fp = new L.MarkerClusterGroup({showCoverageOnHover:false, iconCreateFunction: fpCluster,spiderfyOnMaxZoom:true});
    markers_sp_cs = new L.MarkerClusterGroup({showCoverageOnHover:false,iconCreateFunction: bcCluster,spiderfyOnMaxZoom:true});
    markers_sp_fp = new L.MarkerClusterGroup({showCoverageOnHover:false, iconCreateFunction: fpCluster,spiderfyOnMaxZoom:true});

 	addAllMarkers();	
 
 	step1();
 
 	
   }

   function bcCluster(cluster) {
		var childCount = cluster.getChildCount();

		var c = ' marker-cluster-';
		if (childCount < 10) {
			c += 'small';
		} else if (childCount < 100) {
			c += 'medium';
		} else {
			c += 'large';
		}
		c+="-2"
		return new L.DivIcon({ html: '<div><span style="line-height:'+s(childCount)+'px;">' + childCount + '</span></div>', className: 'marker-cluster' + c, iconSize: new L.Point(s(childCount), s(childCount)) });
	}
	
	
	 function fpCluster(cluster) {
		var childCount = cluster.getChildCount();

		var c = ' marker-cluster-';
		if (childCount < 10) {
			c += 'small';
		} else if (childCount < 100) {
			c += 'medium';
		} else {
			c += 'large';
		}
		
		return new L.DivIcon({ html: '<div><span style="line-height:'+s(childCount)+'px;">' + childCount + '</span></div>', className: 'marker-cluster' + c, iconSize: new L.Point(s(childCount), s(childCount)) });
	}
	
	function step1() {
		
	if (map.hasLayer(markers_sp_cs)) map.removeLayer(markers_sp_cs);
   	if (map.hasLayer(markers_sp_fp)) map.removeLayer(markers_sp_fp);
   	
   	map.addLayer(markers_cs);
   	map.addLayer(markers_fp);
	
	map.setView([18.95, 18.08333], 3,{animate:true});
	}
   
   function step2() {
   	
   	if (map.hasLayer(markers_cs)) map.removeLayer(markers_cs);
   	if (map.hasLayer(markers_fp)) map.removeLayer(markers_fp);
   	
  
   	map.addLayer(markers_sp_cs);
   	map.addLayer(markers_sp_fp);
  
   	
   	map.setView([18.95, 18.08333], 3,{animate:true});
   	}
   
   
   function step3() {
   	step2();
   	map.setView([11.583333, 122.75],6,{animate:true});	
   }
     
   function addAllMarkers () {
   	for (var i = 0; i < mapdata.length; i++) {
        var a = mapdata[i];
       
        var title = a['revid'];
        var type = a['type'];
        var date = a['date'];
        var comment = a['comment'];
        var user = a['user'];
       
        if(a.lat!="" && a.lon!="" && a.page=="Birth Control") {
       
        var marker = L.circleMarker(new L.LatLng(a['lat'].replace(",","."), a['lon'].replace(",",".")), {
            //icon: L.mapbox.marker.icon({ 'marker-color': 'd45158'}),
            radius: 5,
        	fillColor: "#d45158",
        	stroke: false,
        	fillOpacity: 0.69,
            title: title,
            date: date,
            user: user,
            comment: comment,
            type: type
        });
        marker.bindPopup("<br/><div><b>Date:</b> "+date+"</div><div><b>User:</b> "+user+"</div><div><b>Revision id:</b> "+title+"</div><div><b>type:</b> "+type+"</div><div><b>Comment:</b> "+comment+"</div>");
        markers_cs.addLayer(marker);
        
       }
       
       if(a.lat!="" && a.lon!="" && a.page=="Birth Control" && a.type=="spoil") {
       
        var marker = L.circleMarker(new L.LatLng(a['lat'].replace(",","."), a['lon'].replace(",",".")), {
            //icon: L.mapbox.marker.icon({ 'marker-color': 'd45158'}),
            radius: 5,
        	fillColor: "#d45158",
        	stroke: false,
        	fillOpacity: 0.69,
            title: title,
            date: date,
            user: user,
            comment: comment,
            type: type
        });
        marker.bindPopup("<br/><div><b>Date:</b> "+date+"</div><div><b>User:</b> "+user+"</div><div><b>Revision id:</b> "+title+"</div><div><b>type:</b> "+type+"</div><div><b>Comment:</b> "+comment+"</div>");
        markers_sp_cs.addLayer(marker);
        
        
       }
       
       if(a.lat!="" && a.lon!="" && a.page=="Family Planning") {
       	
        
        var marker = L.circleMarker(new L.LatLng(a['lat'].replace(",","."), a['lon'].replace(",",".")), {
            //icon: L.mapbox.marker.icon({ 'marker-color': '34CD87'}),
            radius: 5,
        	fillColor: "#34CD87",
        	stroke: false,
        	fillOpacity: 0.69,
            title: title,
            date: date,
            user: user,
            comment: comment,
            type: type
        });
        marker.bindPopup("<br/><div><b>Date:</b> "+date+"</div><div><b>User:</b> "+user+"</div><div><b>Revision id:</b> "+title+"</div><div><b>type:</b> "+type+"</div><div><b>Comment:</b> "+comment+"</div>");
        markers_fp.addLayer(marker);
        
       }
       
       if(a.lat!="" && a.lon!="" && a.page=="Family Planning" && a.type=="spoil") {
       
        var marker = L.circleMarker(new L.LatLng(a['lat'].replace(",","."), a['lon'].replace(",",".")), {
            //icon: L.mapbox.marker.icon({ 'marker-color': 'd45158'}),
            radius: 5,
        	fillColor: "#d45158",
        	stroke: false,
        	fillOpacity: 0.69,
            title: title,
            date: date,
            user: user,
            comment: comment,
            type: type
        });
        marker.bindPopup("<br/><div><b>Date:</b> "+date+"</div><div><b>User:</b> "+user+"</div><div><b>Revision id:</b> "+title+"</div><div><b>type:</b> "+type+"</div><div><b>Comment:</b> "+comment+"</div>");
        markers_sp_fp.addLayer(marker);
 
       }
    }
   } 
</script>